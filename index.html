<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adlify - Lead Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = { theme: { extend: { colors: { 'primary': '#FF6B35', 'secondary': '#E91E63', 'accent': '#9C27B0' } } } }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #FF6B35 0%, #E91E63 50%, #9C27B0 100%); }
        .gradient-text { background: linear-gradient(135deg, #FF6B35, #E91E63, #9C27B0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- HEADER -->
    <header class="gradient-bg text-white">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center font-bold text-lg">A</div>
                <span class="text-2xl font-bold">ADLIFY</span>
            </div>
            <div class="flex items-center gap-4">
                <span id="dbStatus" class="text-sm bg-white/20 px-3 py-1 rounded-full">‚è≥ Prip√°jam...</span>
                <button onclick="openSettings()" class="hover:bg-white/10 p-2 rounded-lg">‚öôÔ∏è</button>
            </div>
        </div>
    </header>

    <!-- STATS BAR -->
    <div class="bg-white border-b shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-3 flex gap-8 text-sm">
            <div><span class="text-gray-500">Celkom:</span> <strong id="statTotal">0</strong></div>
            <div>üÜï <strong id="statNew">0</strong></div>
            <div>‚ú® <strong id="statReady">0</strong></div>
            <div>üìß <strong id="statContacted">0</strong></div>
            <div>‚úÖ <strong id="statConverted">0</strong></div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- TABS -->
        <div class="flex gap-2 mb-6">
            <button onclick="showTab('import')" id="tab-import" class="tab-btn active">üì• Import</button>
            <button onclick="showTab('manual')" id="tab-manual" class="tab-btn">‚úèÔ∏è Manu√°lne</button>
        </div>

        <!-- IMPORT PANEL -->
        <div id="panel-import" class="panel bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">üì• Import dom√©n</h2>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="md:col-span-3">
                    <textarea id="importDomains" rows="4" placeholder="firma1.sk&#10;firma2.sk&#10;firma3.sk" class="w-full p-3 border rounded-xl font-mono text-sm"></textarea>
                </div>
                <div class="flex flex-col gap-2">
                    <input type="url" id="importSourceUrl" placeholder="Zdrojov√Ω odkaz (voliteƒæn√©)" class="p-3 border rounded-xl text-sm">
                    <button onclick="handleImport()" class="gradient-bg text-white font-semibold py-3 rounded-xl hover:opacity-90">üì• Importova≈•</button>
                </div>
            </div>
        </div>

        <!-- MANUAL PANEL -->
        <div id="panel-manual" class="panel bg-white rounded-2xl shadow-lg p-6 mb-8 hidden">
            <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Prida≈• firmu manu√°lne</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <input type="text" id="manualName" placeholder="N√°zov firmy *" class="p-3 border rounded-xl">
                <input type="text" id="manualIndustry" placeholder="Odvetvie *" class="p-3 border rounded-xl">
                <input type="text" id="manualCity" placeholder="Mesto *" class="p-3 border rounded-xl">
                <input type="text" id="manualDomain" placeholder="Web (voliteƒæn√©)" class="p-3 border rounded-xl">
                <input type="email" id="manualEmail" placeholder="Email (voliteƒæn√©)" class="p-3 border rounded-xl">
                <input type="url" id="manualSourceUrl" placeholder="Zdrojov√Ω odkaz (FB, Google Maps...)" class="p-3 border rounded-xl">
                <div class="md:col-span-3">
                    <textarea id="manualNotes" rows="2" placeholder="Pozn√°mky, popis slu≈æieb..." class="w-full p-3 border rounded-xl"></textarea>
                </div>
            </div>
            <button onclick="handleManualAdd()" class="mt-4 gradient-bg text-white font-semibold py-3 px-8 rounded-xl hover:opacity-90">‚ûï Prida≈•</button>
        </div>

        <!-- FILTERS -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-6">
            <div class="flex flex-wrap gap-4 items-end">
                <div>
                    <label class="text-xs text-gray-500 block mb-1">Status</label>
                    <select id="filterStatus" onchange="loadLeads()" class="p-2 border rounded-lg text-sm">
                        <option value="">V≈°etky</option>
                        <option value="new">üÜï Nov√©</option>
                        <option value="ready">‚ú® Ready</option>
                        <option value="contacted">üìß Kontaktovan√©</option>
                        <option value="converted">‚úÖ Klienti</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500 block mb-1">Sk√≥re</label>
                    <select id="filterScore" onchange="loadLeads()" class="p-2 border rounded-lg text-sm">
                        <option value="">V≈°etky</option>
                        <option value="80">‚≠ê 80+</option>
                        <option value="60">‚≠ê 60+</option>
                        <option value="40">‚≠ê 40+</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="text-xs text-gray-500 block mb-1">Hƒæada≈•</label>
                    <input type="text" id="filterSearch" onkeyup="loadLeads()" placeholder="N√°zov, dom√©na, mesto..." class="w-full p-2 border rounded-lg text-sm">
                </div>
                <div class="flex gap-2">
                    <button onclick="selectAllLeads()" class="p-2 bg-gray-100 rounded-lg text-sm" title="Vybra≈• v≈°etky">‚òëÔ∏è</button>
                    <button onclick="bulkSetStatus('ready')" class="p-2 bg-purple-100 text-purple-700 rounded-lg text-sm">‚ú® Ready</button>
                    <button onclick="bulkDelete()" class="p-2 bg-red-100 text-red-700 rounded-lg text-sm">üóëÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- LEADS LIST -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h2 class="text-lg font-semibold">Leady: <span class="gradient-text" id="leadsCount">0</span></h2>
            </div>
            <div id="leadsList"></div>
            <div id="emptyState" class="p-12 text-center text-gray-400 hidden">
                <div class="text-5xl mb-4">üì≠</div>
                <p>Zatiaƒæ ≈æiadne leady</p>
            </div>
        </div>
    </main>

    <!-- SETTINGS MODAL -->
    <div id="modalSettings" class="modal hidden">
        <div class="modal-content max-w-md">
            <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Nastavenia</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Claude API kƒæ√∫ƒç</label>
                <input type="password" id="inputApiKey" placeholder="sk-ant-..." class="w-full p-3 border rounded-xl font-mono text-sm">
                <p class="text-xs text-gray-400 mt-1">Z√≠skaj na <a href="https://console.anthropic.com" target="_blank" class="text-primary">console.anthropic.com</a></p>
            </div>
            <div class="flex gap-3">
                <button onclick="saveSettings()" class="flex-1 gradient-bg text-white font-semibold py-3 rounded-xl">üíæ Ulo≈æi≈•</button>
                <button onclick="closeModal('modalSettings')" class="px-6 py-3 bg-gray-100 rounded-xl">Zru≈°i≈•</button>
            </div>
        </div>
    </div>

    <!-- STATUS MODAL -->
    <div id="modalStatus" class="modal hidden">
        <div class="modal-content max-w-sm">
            <h2 class="text-xl font-bold mb-4">Zmeni≈• stav</h2>
            <input type="hidden" id="modalStatusLeadId">
            <div class="grid grid-cols-2 gap-3 mb-4">
                <button onclick="setLeadStatus('new')" class="p-3 bg-blue-100 text-blue-700 rounded-xl font-medium">üÜï Nov√Ω</button>
                <button onclick="setLeadStatus('ready')" class="p-3 bg-purple-100 text-purple-700 rounded-xl font-medium">‚ú® Ready</button>
                <button onclick="setLeadStatus('contacted')" class="p-3 bg-orange-100 text-orange-700 rounded-xl font-medium">üìß Kontaktovan√Ω</button>
                <button onclick="setLeadStatus('converted')" class="p-3 bg-green-100 text-green-700 rounded-xl font-medium">‚úÖ Klient</button>
            </div>
            <button onclick="deleteSingleLead()" class="w-full p-3 bg-red-100 text-red-700 rounded-xl font-medium mb-3">üóëÔ∏è Vymaza≈•</button>
            <button onclick="closeModal('modalStatus')" class="w-full p-3 bg-gray-100 rounded-xl">Zru≈°i≈•</button>
        </div>
    </div>

    <!-- EDITOR MODAL -->
    <div id="modalEditor" class="modal hidden">
        <div class="modal-content max-w-4xl max-h-[90vh] overflow-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">‚úèÔ∏è Upravi≈• prezent√°ciu</h2>
                <button onclick="closeModal('modalEditor')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            <input type="hidden" id="editorLeadId">
            
            <div class="space-y-4">
                <!-- Basic Info -->
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">N√°zov firmy</label>
                        <input type="text" id="editName" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Odvetvie</label>
                        <input type="text" id="editIndustry" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Mesto</label>
                        <input type="text" id="editCity" class="w-full p-2 border rounded-lg">
                    </div>
                </div>
                
                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium mb-1">Popis firmy</label>
                    <textarea id="editDescription" rows="2" class="w-full p-2 border rounded-lg"></textarea>
                </div>
                
                <!-- Potential -->
                <div>
                    <label class="block text-sm font-medium mb-1">Potenci√°l (preƒço je reklama vhodn√°)</label>
                    <textarea id="editPotential" rows="2" class="w-full p-2 border rounded-lg"></textarea>
                </div>
                
                <!-- Strengths -->
                <div>
                    <label class="block text-sm font-medium mb-1">Siln√© str√°nky (3 riadky: N√°zov | Popis)</label>
                    <textarea id="editStrengths" rows="3" class="w-full p-2 border rounded-lg font-mono text-sm" placeholder="18 rokov sk√∫senost√≠ | Budujete znaƒçku a d√¥veru
Komplexn√© slu≈æby | V≈°etko pod jednou strechou
V√Ωborn√© recenzie | 180+ pozit√≠vnych hodnoten√≠"></textarea>
                </div>
                
                <!-- Opportunity -->
                <div>
                    <label class="block text-sm font-medium mb-1">Pr√≠le≈æitos≈• (N√°zov | Popis)</label>
                    <input type="text" id="editOpportunity" class="w-full p-2 border rounded-lg font-mono text-sm" placeholder="Nevyu≈æit√Ω Google Ads | Z√°kazn√≠ci v√°s hƒæadaj√∫ ale nevidia">
                </div>
                
                <!-- Campaigns -->
                <div>
                    <label class="block text-sm font-medium mb-1">Kampane (3 riadky: Emoji | N√°zov | Popis)</label>
                    <textarea id="editCampaigns" rows="3" class="w-full p-2 border rounded-lg font-mono text-sm" placeholder="üöó | Poistn√© udalosti | Urgentn√Ω dopyt po nehode
üîß | Sez√≥nne slu≈æby | Prez√∫vanie, klimatiz√°cia
üíé | Premium slu≈æby | Lakov≈àa, CNC oprava diskov"></textarea>
                </div>
                
                <!-- Keywords -->
                <div>
                    <label class="block text-sm font-medium mb-1">Kƒæ√∫ƒçov√© slov√° (5 riadkov: Slovo | Objem | low/medium/high | Pozn√°mka)</label>
                    <textarea id="editKeywords" rows="5" class="w-full p-2 border rounded-lg font-mono text-sm" placeholder="autoservis bratislava | 880 | medium | Hlavn√Ω zdroj
pneuservis bratislava | 500 | high | Sez√≥nny boom
autolakov≈àa bratislava | 300 | low | Vysok√° mar≈æa"></textarea>
                </div>
                
                <!-- ROI -->
                <div class="bg-orange-50 rounded-xl p-4">
                    <label class="block text-sm font-medium mb-2">ROI odhad</label>
                    <div class="grid grid-cols-4 gap-3">
                        <div>
                            <label class="text-xs text-gray-500">Min z√°kazn√≠kov</label>
                            <input type="number" id="editRoiMin" class="w-full p-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500">Max z√°kazn√≠kov</label>
                            <input type="number" id="editRoiMax" class="w-full p-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500">Priem. √∫trata ‚Ç¨</label>
                            <input type="number" id="editRoiAvg" class="w-full p-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500">Pozn√°mka</label>
                            <input type="text" id="editRoiNote" class="w-full p-2 border rounded-lg">
                        </div>
                    </div>
                </div>
                
                <!-- Benefits -->
                <div>
                    <label class="block text-sm font-medium mb-1">Benefity spolupr√°ce (4 riadky: Emoji | N√°zov | Popis)</label>
                    <textarea id="editBenefits" rows="4" class="w-full p-2 border rounded-lg font-mono text-sm" placeholder="üéØ | Urgentn√≠ z√°kazn√≠ci | Oslov√≠te ƒæud√≠ ktor√≠ pr√°ve teraz hƒæadaj√∫
üìä | Merateƒæn√© v√Ωsledky | Presne viete koƒæko ƒæud√≠ kliklo
üèÜ | Konkurenƒçn√° v√Ωhoda | Vy inzerujete, konkurencia nie
üìÖ | Sez√≥nne kampane | Nav√Ω≈°ime rozpoƒçet pred sez√≥nou"></textarea>
                </div>
                
                <!-- Ad Examples -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 rounded-xl p-4">
                        <label class="block text-sm font-medium mb-2">üîç Google Ads</label>
                        <input type="text" id="editGoogleH1" placeholder="Headline 1 (max 30 znakov)" class="w-full p-2 border rounded-lg mb-2 text-sm">
                        <input type="text" id="editGoogleH2" placeholder="Headline 2 (max 30 znakov)" class="w-full p-2 border rounded-lg mb-2 text-sm">
                        <input type="text" id="editGoogleH3" placeholder="Headline 3 (max 30 znakov)" class="w-full p-2 border rounded-lg mb-2 text-sm">
                        <textarea id="editGoogleDesc" rows="2" placeholder="Popis (max 90 znakov)" class="w-full p-2 border rounded-lg text-sm"></textarea>
                    </div>
                    <div class="bg-indigo-50 rounded-xl p-4">
                        <label class="block text-sm font-medium mb-2">üìò Facebook Ads</label>
                        <input type="text" id="editFbHeadline" placeholder="Headline" class="w-full p-2 border rounded-lg mb-2 text-sm">
                        <textarea id="editFbText" rows="3" placeholder="Primary text (2-3 vety)" class="w-full p-2 border rounded-lg mb-2 text-sm"></textarea>
                        <input type="text" id="editFbCta" placeholder="CTA tlaƒçidlo (napr. Zisti≈• viac)" class="w-full p-2 border rounded-lg text-sm">
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6 sticky bottom-0 bg-white pt-4 border-t">
                <button onclick="saveEditor()" class="flex-1 gradient-bg text-white font-semibold py-3 rounded-xl">üíæ Ulo≈æi≈•</button>
                <button onclick="generateFromEditor()" class="px-6 py-3 bg-purple-100 text-purple-700 rounded-xl font-medium">üìÑ Generova≈• prezent√°ciu</button>
                <button onclick="closeModal('modalEditor')" class="px-6 py-3 bg-gray-100 rounded-xl">Zru≈°i≈•</button>
            </div>
        </div>
    </div>

    <style>
        .tab-btn { @apply px-4 py-2 rounded-lg font-medium bg-gray-100 text-gray-700 transition-all; }
        .tab-btn.active { @apply bg-primary text-white; }
        .modal { @apply fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4; }
        .modal-content { @apply bg-white rounded-2xl p-6 w-full; }
    </style>

    <script>
    // ===================== CONFIG =====================
    const SUPABASE_URL = 'https://eidkljfaeqvvegiponwl.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpZGtsamZhZXF2dmVnaXBvbndsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4NTgzNjgsImV4cCI6MjA4MjQzNDM2OH0.jFJe_IddYNiO-TOAdxhPSYtSQJlx4i6CFflB0CN4AIQ';
    
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let CLAUDE_API = localStorage.getItem('claude_api_key') || '';
    let selectedIds = new Set();

    // ===================== INIT =====================
    (async () => {
        try {
            const { error } = await db.from('leads').select('id').limit(1);
            document.getElementById('dbStatus').textContent = error ? '‚ùå Chyba DB' : '‚úÖ Pripojen√©';
            document.getElementById('dbStatus').className = `text-sm px-3 py-1 rounded-full ${error ? 'bg-red-500/30' : 'bg-green-500/30'}`;
        } catch(e) {
            document.getElementById('dbStatus').textContent = '‚ùå Offline';
        }
        await loadStats();
        await loadLeads();
    })();

    // ===================== DATA =====================
    async function loadStats() {
        const { data } = await db.from('leads').select('status');
        if (!data) return;
        document.getElementById('statTotal').textContent = data.length;
        document.getElementById('statNew').textContent = data.filter(l => l.status === 'new').length;
        document.getElementById('statReady').textContent = data.filter(l => l.status === 'ready').length;
        document.getElementById('statContacted').textContent = data.filter(l => l.status === 'contacted').length;
        document.getElementById('statConverted').textContent = data.filter(l => l.status === 'converted').length;
    }

    async function loadLeads() {
        const status = document.getElementById('filterStatus').value;
        const minScore = document.getElementById('filterScore').value;
        const search = document.getElementById('filterSearch').value.toLowerCase();
        
        let query = db.from('leads').select('*').order('created_at', { ascending: false });
        if (status) query = query.eq('status', status);
        if (minScore) query = query.gte('score', parseInt(minScore));
        
        const { data } = await query;
        let leads = data || [];
        
        if (search) {
            leads = leads.filter(l => 
                (l.company_name || '').toLowerCase().includes(search) ||
                (l.domain || '').toLowerCase().includes(search) ||
                (l.analysis?.city || '').toLowerCase().includes(search) ||
                (l.analysis?.industry || '').toLowerCase().includes(search)
            );
        }
        
        renderLeads(leads);
    }

    function renderLeads(leads) {
        document.getElementById('leadsCount').textContent = leads.length;
        document.getElementById('emptyState').classList.toggle('hidden', leads.length > 0);
        
        document.getElementById('leadsList').innerHTML = leads.map(lead => {
            const isLocal = !lead.domain || lead.domain.endsWith('.local');
            const a = lead.analysis || {};
            return `
            <div class="px-6 py-4 border-b hover:bg-gray-50 flex items-center gap-4">
                <input type="checkbox" ${selectedIds.has(lead.id) ? 'checked' : ''} onchange="toggleSelect('${lead.id}')" class="w-5 h-5 rounded">
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 flex-wrap mb-1">
                        <strong class="truncate">${lead.company_name || lead.domain}</strong>
                        ${!isLocal ? `<a href="https://${lead.domain}" target="_blank" class="text-sm text-primary">${lead.domain}</a>` : '<span class="text-xs bg-gray-100 px-2 py-0.5 rounded">bez webu</span>'}
                        <span class="px-2 py-0.5 rounded text-xs ${statusClass(lead.status)}">${statusText(lead.status)}</span>
                        ${a.source_url ? `<a href="${a.source_url}" target="_blank" class="text-xs text-gray-400 hover:text-primary" title="${a.source_url}">üîó</a>` : ''}
                    </div>
                    <div class="text-sm text-gray-500 truncate">
                        ${a.city ? 'üìç ' + a.city + ' ' : ''}
                        ${a.industry ? 'üè∑Ô∏è ' + a.industry + ' ' : ''}
                        ${lead.email ? 'üìß ' + lead.email : ''}
                    </div>
                </div>
                <div class="flex items-center gap-2 flex-shrink-0">
                    <span class="px-3 py-1 rounded-full text-sm font-semibold ${scoreClass(lead.score)}">‚≠ê${lead.score || 50}</span>
                    ${lead.status === 'new' ? `<button onclick="analyzeLead('${lead.id}')" class="px-3 py-2 bg-orange-100 text-orange-700 rounded-lg text-sm font-medium hover:bg-orange-200">ü§ñ</button>` : ''}
                    ${lead.analysis ? `<button onclick="openEditor('${lead.id}')" class="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200">‚úèÔ∏è</button>` : ''}
                    ${lead.analysis ? `<button onclick="generatePresentation('${lead.id}')" class="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200">üìÑ</button>` : ''}
                    <button onclick="openStatusModal('${lead.id}')" class="px-3 py-2 bg-gray-100 rounded-lg text-sm hover:bg-gray-200">‚öôÔ∏è</button>
                </div>
            </div>`;
        }).join('');
    }

    function statusClass(s) { return { new: 'bg-blue-100 text-blue-700', ready: 'bg-purple-100 text-purple-700', contacted: 'bg-orange-100 text-orange-700', converted: 'bg-green-100 text-green-700', analyzing: 'bg-yellow-100 text-yellow-700' }[s] || 'bg-gray-100'; }
    function statusText(s) { return { new: 'üÜï Nov√Ω', ready: '‚ú® Ready', contacted: 'üìß Kontakt.', converted: '‚úÖ Klient', analyzing: '‚è≥ Analyzujem' }[s] || s; }
    function scoreClass(s) { return (s || 50) >= 80 ? 'bg-green-100 text-green-700' : (s || 50) >= 60 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'; }

    // ===================== TABS =====================
    function showTab(tab) {
        document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('panel-' + tab).classList.remove('hidden');
        document.getElementById('tab-' + tab).classList.add('active');
    }

    // ===================== IMPORT =====================
    async function handleImport() {
        const text = document.getElementById('importDomains').value.trim();
        const sourceUrl = document.getElementById('importSourceUrl').value.trim();
        if (!text) return alert('Zadaj dom√©ny');
        
        const domains = text.split('\n').map(d => d.trim().replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0]).filter(d => d.includes('.'));
        let added = 0;
        let skipped = 0;
        
        for (const domain of domains) {
            const { data: existing } = await db.from('leads').select('id').eq('domain', domain);
            
            if (existing && existing.length > 0) {
                skipped++;
                continue;
            }
            
            // Insert with only core columns
            const { data, error } = await db.from('leads').insert({ 
                domain, 
                company_name: domain.split('.')[0], 
                status: 'new', 
                score: 50,
                analysis: sourceUrl ? { source_url: sourceUrl } : null
            });
            
            if (error) {
                console.error('Insert error for', domain, error);
            } else {
                added++;
            }
        }
        
        alert(`‚úÖ Importovan√Ωch: ${added}${skipped ? `, preskoƒçen√Ωch: ${skipped}` : ''}`);
        document.getElementById('importDomains').value = '';
        document.getElementById('importSourceUrl').value = '';
        await loadLeads();
        await loadStats();
    }

    // ===================== MANUAL ADD =====================
    async function handleManualAdd() {
        const name = document.getElementById('manualName').value.trim();
        const industry = document.getElementById('manualIndustry').value.trim();
        const city = document.getElementById('manualCity').value.trim();
        const domain = document.getElementById('manualDomain').value.trim();
        const email = document.getElementById('manualEmail').value.trim();
        const sourceUrl = document.getElementById('manualSourceUrl').value.trim();
        const notes = document.getElementById('manualNotes').value.trim();
        
        if (!name || !industry || !city) return alert('Vypl≈à n√°zov, odvetvie a mesto');
        
        let finalDomain = domain ? domain.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0] : 
            name.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-z0-9]/g, '') + '.local';
        
        const { data: existing } = await db.from('leads').select('id').eq('domain', finalDomain);
        if (existing && existing.length > 0) return alert('Firma u≈æ existuje');
        
        try {
            const { data: newLead, error } = await db.from('leads').insert({
                domain: finalDomain,
                company_name: name,
                status: 'new',
                score: 50,
                analysis: { 
                    company_name: name, 
                    industry, 
                    city, 
                    description: notes || `${name} - ${industry} v meste ${city}`,
                    source_url: sourceUrl || null,
                    email: email || null
                }
            }).select().single();
            
            if (error) throw error;
            
            // Clear form
            ['manualName', 'manualIndustry', 'manualCity', 'manualDomain', 'manualEmail', 'manualSourceUrl', 'manualNotes'].forEach(id => document.getElementById(id).value = '');
            
            await loadLeads();
            await loadStats();
            alert('‚úÖ Firma pridan√°!');
            
            if (confirm('Analyzova≈• teraz?')) await analyzeLead(newLead.id);
        } catch(e) {
            alert('Chyba: ' + e.message);
        }
    }

    // ===================== SELECTION =====================
    function toggleSelect(id) { selectedIds.has(id) ? selectedIds.delete(id) : selectedIds.add(id); }
    
    function selectAllLeads() {
        const boxes = document.querySelectorAll('#leadsList input[type="checkbox"]');
        const allChecked = [...boxes].every(b => b.checked);
        boxes.forEach(b => {
            b.checked = !allChecked;
            const id = b.getAttribute('onchange').match(/'([^']+)'/)?.[1];
            if (id) { !allChecked ? selectedIds.add(id) : selectedIds.delete(id); }
        });
    }
    
    async function bulkSetStatus(status) {
        if (!selectedIds.size) return alert('Vyber leady');
        for (const id of selectedIds) await db.from('leads').update({ status }).eq('id', id);
        selectedIds.clear();
        await loadLeads();
        await loadStats();
    }
    
    async function bulkDelete() {
        if (!selectedIds.size) return alert('Vyber leady');
        if (!confirm(`Vymaza≈• ${selectedIds.size} leadov?`)) return;
        for (const id of selectedIds) await db.from('leads').delete().eq('id', id);
        selectedIds.clear();
        await loadLeads();
        await loadStats();
    }

    // ===================== MODALS =====================
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    
    function openSettings() { document.getElementById('inputApiKey').value = CLAUDE_API; openModal('modalSettings'); }
    function saveSettings() { CLAUDE_API = document.getElementById('inputApiKey').value.trim(); localStorage.setItem('claude_api_key', CLAUDE_API); closeModal('modalSettings'); alert('‚úÖ Ulo≈æen√©'); }
    
    function openStatusModal(id) { document.getElementById('modalStatusLeadId').value = id; openModal('modalStatus'); }
    async function setLeadStatus(status) { await db.from('leads').update({ status }).eq('id', document.getElementById('modalStatusLeadId').value); closeModal('modalStatus'); await loadLeads(); await loadStats(); }
    async function deleteSingleLead() { if (!confirm('Vymaza≈•?')) return; await db.from('leads').delete().eq('id', document.getElementById('modalStatusLeadId').value); closeModal('modalStatus'); await loadLeads(); await loadStats(); }

    // Close modals on backdrop click
    document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if (e.target === m) closeModal(m.id); }));

    // ===================== EDITOR =====================
    let currentEditLead = null;
    
    async function openEditor(id) {
        const { data: lead } = await db.from('leads').select('*').eq('id', id).single();
        if (!lead) return;
        currentEditLead = lead;
        const a = lead.analysis || {};
        
        document.getElementById('editorLeadId').value = id;
        document.getElementById('editName').value = a.company_name || lead.company_name || '';
        document.getElementById('editIndustry').value = a.industry || '';
        document.getElementById('editCity').value = a.city || '';
        document.getElementById('editDescription').value = a.description || '';
        document.getElementById('editPotential').value = a.potential_text || '';
        
        document.getElementById('editStrengths').value = (a.strengths || []).map(s => `${s.title} | ${s.description}`).join('\n');
        document.getElementById('editOpportunity').value = a.opportunity ? `${a.opportunity.title} | ${a.opportunity.description}` : '';
        document.getElementById('editCampaigns').value = (a.campaign_ideas || []).map(c => `${c.icon} | ${c.title} | ${c.description}`).join('\n');
        document.getElementById('editKeywords').value = (a.keywords || []).map(k => `${k.keyword} | ${k.volume} | ${k.difficulty} | ${k.note || ''}`).join('\n');
        
        const roi = a.roi || {};
        document.getElementById('editRoiMin').value = roi.new_customers_min || 40;
        document.getElementById('editRoiMax').value = roi.new_customers_max || 70;
        document.getElementById('editRoiAvg').value = roi.avg_order_value || 100;
        document.getElementById('editRoiNote').value = roi.note || '';
        
        document.getElementById('editBenefits').value = (a.benefits || []).map(b => `${b.icon} | ${b.title} | ${b.description}`).join('\n');
        
        const ads = a.ad_examples || {};
        const g = ads.google || {};
        document.getElementById('editGoogleH1').value = g.headline1 || '';
        document.getElementById('editGoogleH2').value = g.headline2 || '';
        document.getElementById('editGoogleH3').value = g.headline3 || '';
        document.getElementById('editGoogleDesc').value = g.description || '';
        
        const f = ads.facebook || {};
        document.getElementById('editFbHeadline').value = f.headline || '';
        document.getElementById('editFbText').value = f.primary_text || '';
        document.getElementById('editFbCta').value = f.cta || 'Zisti≈• viac';
        
        openModal('modalEditor');
    }
    
    function getEditorData() {
        const parseLines = (text, keys) => text.split('\n').filter(l => l.trim()).map(line => {
            const parts = line.split('|').map(p => p.trim());
            const obj = {};
            keys.forEach((k, i) => obj[k] = parts[i] || '');
            return obj;
        });
        
        const oppLine = document.getElementById('editOpportunity').value.trim();
        const oppParts = oppLine.split('|').map(p => p.trim());
        
        return {
            company_name: document.getElementById('editName').value.trim(),
            industry: document.getElementById('editIndustry').value.trim(),
            city: document.getElementById('editCity').value.trim(),
            description: document.getElementById('editDescription').value.trim(),
            potential_text: document.getElementById('editPotential').value.trim(),
            potential_estimate: '+50-80',
            strengths: parseLines(document.getElementById('editStrengths').value, ['title', 'description']),
            opportunity: { title: oppParts[0] || '', description: oppParts[1] || '' },
            campaign_ideas: parseLines(document.getElementById('editCampaigns').value, ['icon', 'title', 'description']),
            keywords: parseLines(document.getElementById('editKeywords').value, ['keyword', 'volume', 'difficulty', 'note']).map(k => ({ ...k, volume: parseInt(k.volume) || 100 })),
            roi: {
                new_customers_min: parseInt(document.getElementById('editRoiMin').value) || 40,
                new_customers_max: parseInt(document.getElementById('editRoiMax').value) || 70,
                avg_order_value: parseInt(document.getElementById('editRoiAvg').value) || 100,
                note: document.getElementById('editRoiNote').value.trim()
            },
            benefits: parseLines(document.getElementById('editBenefits').value, ['icon', 'title', 'description']),
            ad_examples: {
                google: {
                    headline1: document.getElementById('editGoogleH1').value.trim(),
                    headline2: document.getElementById('editGoogleH2').value.trim(),
                    headline3: document.getElementById('editGoogleH3').value.trim(),
                    description: document.getElementById('editGoogleDesc').value.trim()
                },
                facebook: {
                    headline: document.getElementById('editFbHeadline').value.trim(),
                    primary_text: document.getElementById('editFbText').value.trim(),
                    cta: document.getElementById('editFbCta').value.trim() || 'Zisti≈• viac'
                }
            }
        };
    }
    
    async function saveEditor() {
        const id = document.getElementById('editorLeadId').value;
        const analysis = getEditorData();
        await db.from('leads').update({ analysis, company_name: analysis.company_name }).eq('id', id);
        closeModal('modalEditor');
        await loadLeads();
        alert('‚úÖ Ulo≈æen√©');
    }
    
    function generateFromEditor() {
        const analysis = getEditorData();
        const lead = { ...currentEditLead, analysis };
        openPresentationWindow(lead, analysis);
    }

    // ===================== AI ANALYSIS =====================
    async function analyzeLead(id) {
        if (!CLAUDE_API) { alert('Nastav API kƒæ√∫ƒç v ‚öôÔ∏è'); openSettings(); return; }
        
        const { data: lead } = await db.from('leads').select('*').eq('id', id).single();
        if (!lead) return;
        
        await db.from('leads').update({ status: 'analyzing' }).eq('id', id);
        await loadLeads();
        
        try {
            const isLocal = !lead.domain || lead.domain.endsWith('.local');
            let webContent = '';
            let sourceContent = '';
            
            // Fetch website
            if (!isLocal) {
                try {
                    const res = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent('https://' + lead.domain));
                    if (res.ok) {
                        const html = await res.text();
                        const doc = new DOMParser().parseFromString(html, 'text/html');
                        doc.querySelectorAll('script,style,nav,footer,header,aside,iframe,noscript').forEach(e => e.remove());
                        webContent = (doc.body?.innerText || '').replace(/\s+/g, ' ').substring(0, 10000);
                    }
                } catch(e) { console.log('Web fetch failed'); }
            }
            
            // Fetch source URL if available
            if (lead.source_url) {
                try {
                    const res = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(lead.source_url));
                    if (res.ok) {
                        const html = await res.text();
                        const doc = new DOMParser().parseFromString(html, 'text/html');
                        doc.querySelectorAll('script,style').forEach(e => e.remove());
                        sourceContent = (doc.body?.innerText || '').replace(/\s+/g, ' ').substring(0, 5000);
                    }
                } catch(e) { console.log('Source fetch failed'); }
            }
            
            const existingAnalysis = lead.analysis || {};
            
            const prompt = `Si senior marketingov√Ω konzultant pre Adlify.eu - agent√∫ru na online reklamu pre slovensk√© mal√© firmy.

FIRMA:
- N√°zov: ${lead.company_name || 'Nezn√°my'}
- Dom√©na: ${isLocal ? 'Nem√° web' : lead.domain}
${existingAnalysis.industry ? '- Odvetvie: ' + existingAnalysis.industry : ''}
${existingAnalysis.city ? '- Mesto: ' + existingAnalysis.city : ''}
${lead.notes ? '- Pozn√°mky: ' + lead.notes : ''}
${lead.source_url ? '- Zdrojov√Ω odkaz: ' + lead.source_url : ''}

${webContent ? 'WEBSTR√ÅNKA FIRMY:\n' + webContent + '\n' : ''}
${sourceContent ? 'ZDROJOV√Å STR√ÅNKA (napr. Zlat√© str√°nky, FB):\n' + sourceContent + '\n' : ''}

Vytvor KONKR√âTNU anal√Ωzu pre T√öTO firmu. Pou≈æi re√°lne info z webstr√°nky a zdroja.

Vr√°≈• JSON:
{
  "company_name": "Presn√Ω n√°zov",
  "industry": "odvetvie",
  "city": "Mesto",
  "description": "2-3 vety o firme - konkr√©tne fakty (roky, recenzie, slu≈æby...)",
  "potential_text": "2-3 vety preƒço je online reklama vhodn√°",
  "potential_estimate": "+50-80",
  "strengths": [
    {"title": "Siln√° str√°nka 1", "description": "Preƒço je to v√Ωhoda"},
    {"title": "Siln√° str√°nka 2", "description": "Preƒço je to v√Ωhoda"},
    {"title": "Siln√° str√°nka 3", "description": "Preƒço je to v√Ωhoda"}
  ],
  "opportunity": {"title": "Pr√≠le≈æitos≈•", "description": "ƒåo im ch√Ωba"},
  "campaign_ideas": [
    {"icon": "üöó", "title": "Kampa≈à 1", "description": "Preƒço"},
    {"icon": "üîß", "title": "Kampa≈à 2", "description": "Preƒço"},
    {"icon": "üíé", "title": "Kampa≈à 3", "description": "Preƒço"}
  ],
  "keywords": [
    {"keyword": "slovo + mesto", "volume": 500, "difficulty": "medium", "note": "Pozn√°mka"},
    {"keyword": "slovo 2", "volume": 300, "difficulty": "low", "note": "Pozn√°mka"},
    {"keyword": "slovo 3", "volume": 200, "difficulty": "high", "note": "Pozn√°mka"},
    {"keyword": "slovo 4", "volume": 150, "difficulty": "low", "note": "Pozn√°mka"},
    {"keyword": "slovo 5", "volume": 100, "difficulty": "low", "note": "Pozn√°mka"}
  ],
  "roi": {
    "new_customers_min": 40,
    "new_customers_max": 70,
    "avg_order_value": 100,
    "note": "Preƒço je odhad realistick√Ω"
  },
  "benefits": [
    {"icon": "üéØ", "title": "Benefit 1", "description": "Pr√≠nos"},
    {"icon": "üìä", "title": "Benefit 2", "description": "Pr√≠nos"},
    {"icon": "üèÜ", "title": "Benefit 3", "description": "Pr√≠nos"},
    {"icon": "üìÖ", "title": "Benefit 4", "description": "Pr√≠nos"}
  ],
  "ad_examples": {
    "google": {
      "headline1": "Max 30 znakov",
      "headline2": "Max 30 znakov",
      "headline3": "Max 30 znakov",
      "description": "Max 90 znakov s CTA"
    },
    "facebook": {
      "headline": "Headline",
      "primary_text": "2-3 vety s em√≥ciou a CTA",
      "cta": "Zisti≈• viac"
    }
  }
}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'x-api-key': CLAUDE_API, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
                body: JSON.stringify({ model: 'claude-sonnet-4-20250514', max_tokens: 4000, messages: [{ role: 'user', content: prompt }] })
            });
            
            const data = await response.json();
            if (data.error) throw new Error(data.error.message);
            
            const text = data.content[0].text;
            const match = text.match(/\{[\s\S]*\}/);
            const analysis = JSON.parse(match ? match[0] : text);
            
            await db.from('leads').update({ 
                status: 'ready', 
                analysis: { ...existingAnalysis, ...analysis },
                company_name: analysis.company_name || lead.company_name,
                score: 80 
            }).eq('id', id);
            
            alert('‚úÖ Anal√Ωza hotov√°!');
        } catch(e) {
            console.error(e);
            alert('‚ùå Chyba: ' + e.message);
            await db.from('leads').update({ status: 'new' }).eq('id', id);
        }
        
        await loadLeads();
        await loadStats();
    }

    // ===================== PRESENTATION =====================
    async function generatePresentation(id) {
        const { data: lead } = await db.from('leads').select('*').eq('id', id).single();
        if (!lead?.analysis) return alert('Najprv analyzuj');
        openPresentationWindow(lead, lead.analysis);
    }
    
    function openPresentationWindow(lead, a) {
        const html = buildPresentationHTML(lead, a);
        const win = window.open('', '_blank');
        win.document.write(html);
        win.document.close();
    }

    function buildPresentationHTML(lead, a) {
        const name = a.company_name || lead.company_name || lead.domain;
        const isLocal = !lead.domain || lead.domain.endsWith('.local');
        const domain = isLocal ? 'vasafirma.sk' : lead.domain;
        
        const keywordsHTML = (a.keywords || []).map(k => {
            const color = k.difficulty === 'low' ? '#22c55e' : k.difficulty === 'high' ? '#ef4444' : '#f59e0b';
            const label = k.difficulty === 'low' ? 'N√≠zka' : k.difficulty === 'high' ? 'Vysok√°' : 'Stredn√°';
            return `<tr><td><span style="background:rgba(255,255,255,0.1);padding:6px 14px;border-radius:20px">${k.keyword}</span></td><td>${k.volume}/mes</td><td><span style="background:${color};padding:4px 12px;border-radius:12px;font-size:12px">${label}</span></td><td>‚úì ${k.note||''}</td></tr>`;
        }).join('');
        
        const strengthsHTML = (a.strengths || []).map(s => `<div style="background:#fff;border-radius:14px;padding:25px;border-left:4px solid #FF6B35;box-shadow:0 4px 15px rgba(0,0,0,0.05)"><div style="font-weight:600;margin-bottom:8px">‚úì ${s.title}</div><p style="color:#6b7280;font-size:14px">${s.description}</p></div>`).join('');
        
        const campaignsHTML = (a.campaign_ideas || []).map(c => `<div style="background:linear-gradient(135deg,#FF6B35,#E91E63,#9C27B0);border-radius:16px;padding:25px;text-align:center;color:#fff"><div style="font-size:2.5rem;margin-bottom:12px">${c.icon}</div><h4 style="font-weight:600;margin-bottom:8px">${c.title}</h4><p style="font-size:14px;opacity:0.9">${c.description}</p></div>`).join('');
        
        const benefitsHTML = (a.benefits || []).map(b => `<div style="background:#fff;border-radius:16px;padding:25px;display:flex;gap:20px;align-items:flex-start;box-shadow:0 4px 15px rgba(0,0,0,0.05)"><div style="width:50px;height:50px;background:linear-gradient(135deg,#fdf2f8,#faf5ff);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0">${b.icon}</div><div><h4 style="font-weight:600;margin-bottom:5px">${b.title}</h4><p style="font-size:14px;color:#6b7280">${b.description}</p></div></div>`).join('');
        
        const roi = a.roi || {};
        const avgCust = Math.round(((roi.new_customers_min||40) + (roi.new_customers_max||70)) / 2);
        const avgOrder = roi.avg_order_value || 100;
        const revenue = avgCust * avgOrder;
        const profit = revenue - 699;
        
        const ads = a.ad_examples || {};
        const gAd = ads.google || { headline1: name, headline2: 'Kvalitn√© slu≈æby', headline3: 'Zavolajte!', description: 'Profesion√°lne slu≈æby za f√©rov√© ceny. Kontaktujte n√°s!' };
        const fAd = ads.facebook || { headline: `${name}`, primary_text: `Hƒæad√°te spoƒæahliv√©ho partnera? ${name} v√°m poskytne kvalitn√© slu≈æby.`, cta: 'Zisti≈• viac' };

        return `<!DOCTYPE html><html lang="sk"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>N√°vrh pre ${name} | Adlify</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"><style>:root{--orange:#FF6B35;--pink:#E91E63;--purple:#9C27B0;--dark:#1e1e2f;--gray:#6b7280;--gradient:linear-gradient(135deg,#FF6B35 0%,#E91E63 50%,#9C27B0 100%)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:#f8f9fa;color:#1f2937;line-height:1.6}.slide{max-width:1100px;margin:0 auto 50px;background:#fff;border-radius:24px;box-shadow:0 25px 80px rgba(0,0,0,0.08);overflow:hidden;page-break-after:always}.slide-hero{min-height:500px;background:var(--gradient);display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:60px;position:relative}.slide-hero h1{font-size:3.5rem;font-weight:700;color:#fff;margin-bottom:15px}.slide-hero .subtitle{font-size:1.4rem;color:rgba(255,255,255,0.9)}.logo{position:absolute;font-weight:700;color:#fff}.logo.top{top:30px;left:40px;font-size:1.5rem}.logo.bottom{bottom:30px;right:40px;font-size:0.9rem;opacity:0.7}.domain-badge{background:rgba(255,255,255,0.2);padding:12px 30px;border-radius:50px;margin-top:30px;color:#fff;font-weight:500}.slide-content{padding:50px}.slide-header{display:flex;align-items:center;gap:18px;margin-bottom:40px;padding-bottom:20px;border-bottom:3px solid;border-image:var(--gradient) 1}.slide-num{width:50px;height:50px;background:var(--gradient);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:1.3rem}.slide-header h2{font-size:2rem;font-weight:600;color:var(--dark)}.info-box{background:linear-gradient(135deg,#fdf2f8,#faf5ff);border-radius:16px;padding:30px;margin-bottom:25px}.info-box h3{color:var(--pink);font-size:1.1rem;margin-bottom:12px}.potential-box{background:var(--dark);border-radius:16px;padding:30px;color:#fff}.potential-box h3{color:#fbbf24;margin-bottom:12px}.potential-box .highlight{color:#22c55e;font-weight:600}.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:20px}.opp-card{background:#fffbeb;border-radius:14px;padding:25px;border-left:4px solid #f59e0b}.keywords-box{background:var(--dark);border-radius:16px;padding:30px;color:#fff}.keywords-box table{width:100%;border-collapse:collapse}.keywords-box th{text-align:left;padding:12px;font-size:12px;color:rgba(255,255,255,0.6);border-bottom:1px solid rgba(255,255,255,0.1)}.keywords-box td{padding:14px 12px;border-bottom:1px solid rgba(255,255,255,0.05);font-size:14px}.ad-mockup{background:#fff;border-radius:16px;padding:25px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}.ad-mockup h4{font-size:14px;color:var(--gray);margin-bottom:15px}.google-ad{border:1px solid #dfe1e5;border-radius:8px;padding:15px;font-family:Arial,sans-serif}.google-ad .label{font-size:11px;background:#f1f3f4;padding:2px 6px;border-radius:3px;margin-bottom:8px;display:inline-block}.google-ad .url{font-size:14px;color:#202124;margin-bottom:4px}.google-ad .title{font-size:20px;color:#1a0dab;margin-bottom:8px;cursor:pointer}.google-ad .desc{font-size:14px;color:#4d5156}.fb-ad{border:1px solid #dddfe2;border-radius:8px;overflow:hidden;font-family:Helvetica,Arial,sans-serif}.fb-header{padding:12px;display:flex;align-items:center;gap:10px}.fb-avatar{width:40px;height:40px;background:var(--gradient);border-radius:50%}.fb-name{font-size:14px;font-weight:600}.fb-sponsored{font-size:12px;color:#65676b}.fb-content{padding:0 12px 12px}.fb-content p{font-size:15px;margin-bottom:12px}.fb-image{background:linear-gradient(135deg,#667eea,#764ba2);height:200px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;font-weight:600}.fb-cta{padding:12px;background:#f0f2f5;display:flex;justify-content:space-between;align-items:center}.fb-cta-text{font-size:12px;color:#65676b;text-transform:uppercase}.fb-cta-text strong{font-size:15px;color:#050505;display:block;text-transform:none}.fb-btn{background:#1877f2;color:#fff;padding:8px 16px;border-radius:6px;font-size:14px;font-weight:600}.pkg-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}.pkg{background:#fff;border:2px solid #e5e7eb;border-radius:16px;padding:30px;position:relative}.pkg.featured{border-color:var(--orange);box-shadow:0 10px 40px rgba(255,107,53,0.15)}.pkg.featured::before{content:"‚òÖ Odpor√∫ƒçame";position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--gradient);color:#fff;font-size:12px;font-weight:600;padding:5px 15px;border-radius:20px}.pkg h3{font-size:1.2rem;font-weight:600;margin:10px 0 5px}.pkg .price{font-size:2.5rem;font-weight:700;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.pkg .period{color:var(--gray);margin-bottom:20px}.pkg ul{list-style:none}.pkg li{padding:8px 0;font-size:14px}.pkg li::before{content:"‚úì ";color:#22c55e;font-weight:bold}.budget-box{background:#fff7ed;border:2px dashed var(--orange);border-radius:16px;padding:25px}.budget-box h4{color:var(--orange);margin-bottom:20px}.budget-opts{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}.budget-opt{background:#fff;border-radius:12px;padding:20px;text-align:center}.budget-opt.featured{border:2px solid var(--orange);position:relative}.budget-opt.featured::before{content:"Odpor√∫ƒçame";position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--gradient);color:#fff;font-size:10px;padding:3px 10px;border-radius:10px}.budget-opt .amount{font-size:1.8rem;font-weight:700;color:var(--dark)}.budget-opt .label{font-size:12px;color:var(--gray);margin-top:5px}.roi-card{background:#fff;border:2px solid #e5e7eb;border-radius:16px;padding:25px;text-align:center}.roi-card .value{font-size:2.2rem;font-weight:700;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.roi-card .label{font-size:14px;color:var(--gray);margin-top:5px}.calc-box{background:#fff;border-radius:16px;padding:30px;box-shadow:0 4px 15px rgba(0,0,0,0.05)}.calc-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f3f4f6}.calc-row.total{background:#f0fdf4;margin:15px -15px -15px;padding:15px;border-radius:0 0 12px 12px;border:none}.calc-row.total span:last-child{color:#16a34a;font-weight:700;font-size:1.2rem}.slide-cta{background:var(--gradient);padding:80px 50px;text-align:center;color:#fff}.slide-cta h2{font-size:2.8rem;font-weight:700;margin-bottom:20px}.slide-cta p{font-size:1.2rem;opacity:0.9;max-width:600px;margin:0 auto 40px}.cta-btns{display:flex;gap:20px;justify-content:center}.btn{padding:16px 40px;border-radius:50px;font-weight:600;font-size:1rem;text-decoration:none}.btn-white{background:#fff;color:var(--purple)}.btn-outline{border:2px solid #fff;color:#fff;background:transparent}.contact{margin-top:40px;font-size:1rem}.contact a{color:#fff}@media print{.slide{box-shadow:none;margin:0}}</style></head><body>

<div class="slide"><div class="slide-hero"><div class="logo top">Adlify</div><h1>${name}</h1><div class="subtitle">N√°vrh online marketingovej strat√©gie</div>${!isLocal ? `<div class="domain-badge">üåê ${lead.domain}</div>` : ''}<div class="logo bottom">adlify.eu</div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">1</div><h2>O va≈°om biznise</h2></div><div class="info-box"><h3>üëã Kto ste</h3><p>${a.description || 'Profesion√°lna firma poskytuj√∫ca kvalitn√© slu≈æby.'}</p></div><div class="potential-box"><h3>üí° Kde vid√≠me v√°≈° potenci√°l</h3><p>${a.potential_text || 'M√°te potenci√°l v√Ωrazne zv√Ω≈°i≈• poƒçet z√°kazn√≠kov cez online reklamu.'}</p><p><span class="highlight">Odhadujeme ${a.potential_estimate || '+50-80'} nov√Ωch z√°kazn√≠kov mesaƒçne.</span></p></div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">2</div><h2>ƒåo sme o v√°s zistili</h2></div><div class="grid-2" style="margin-bottom:30px">${strengthsHTML}<div class="opp-card"><div style="font-weight:600;margin-bottom:8px">‚ö† ${a.opportunity?.title || 'Nevyu≈æit√Ω potenci√°l'}</div><p style="color:#6b7280;font-size:14px">${a.opportunity?.description || 'Z√°kazn√≠ci v√°s hƒæadaj√∫ online, ale nevidia va≈°u reklamu.'}</p></div></div><div class="grid-3">${campaignsHTML}</div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">3</div><h2>Anal√Ωza kƒæ√∫ƒçov√Ωch slov</h2></div><p style="color:#6b7280;margin-bottom:25px">Uk√°≈æka slov, na ktor√© by sme v√°s zobrazovali v Google:</p><div class="keywords-box"><h4 style="margin-bottom:20px">üîç V√Ωber z anal√Ωzy (70+ kƒæ√∫ƒçov√Ωch slov)</h4><table><thead><tr><th>Kƒæ√∫ƒçov√© slovo</th><th>Vyhƒæad√°vania</th><th>Konkurencia</th><th>Pozn√°mka</th></tr></thead><tbody>${keywordsHTML}</tbody></table><div style="margin-top:20px;padding:15px;background:rgba(255,255,255,0.05);border-radius:10px;font-size:12px;color:rgba(255,255,255,0.6)">* Kompletn√° anal√Ωza obsahuje 70+ kƒæ√∫ƒçov√Ωch slov</div></div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">4</div><h2>Ako bud√∫ vyzera≈• va≈°e reklamy</h2></div><div class="grid-2"><div class="ad-mockup"><h4>üîç Google Ads</h4><div class="google-ad"><div class="label">Sponzorovan√©</div><div class="url">${domain} ‚Ä∫ ${a.industry||'slu≈æby'}</div><div class="title">${gAd.headline1} | ${gAd.headline2} | ${gAd.headline3}</div><div class="desc">${gAd.description}</div></div></div><div class="ad-mockup"><h4>üìò Facebook / Instagram</h4><div class="fb-ad"><div class="fb-header"><div class="fb-avatar"></div><div><div class="fb-name">${name}</div><div class="fb-sponsored">Sponzorovan√© ¬∑ üåê</div></div></div><div class="fb-content"><p>${fAd.primary_text}</p></div><div class="fb-image">${name}</div><div class="fb-cta"><div class="fb-cta-text">${domain.toUpperCase()}<strong>${fAd.headline}</strong></div><div class="fb-btn">${fAd.cta}</div></div></div></div></div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">5</div><h2>N√°vrh spolupr√°ce</h2></div><div class="pkg-grid"><div class="pkg"><div>üöÄ</div><h3>Starter</h3><div class="price">149‚Ç¨</div><div class="period">/ mesiac</div><ul><li>1 platforma</li><li>1 kampa≈à</li><li>2 vizu√°ly</li><li>Mesaƒçn√Ω report</li><li>Email podpora</li></ul></div><div class="pkg featured"><div>‚≠ê</div><h3>Pro</h3><div class="price">249‚Ç¨</div><div class="period">/ mesiac</div><ul><li>2 platformy (FB + Google)</li><li>3 kampane</li><li>4 vizu√°ly</li><li>A/B testovanie</li><li>Telef√≥n podpora</li></ul></div><div class="pkg"><div>üíé</div><h3>Enterprise</h3><div class="price">399‚Ç¨</div><div class="period">/ mesiac</div><ul><li>V≈°etky platformy</li><li>5 kampan√≠</li><li>8 vizu√°lov</li><li>Remarketing</li><li>WhatsApp podpora</li></ul></div></div><div class="budget-box"><h4>üí∞ Odpor√∫ƒçan√Ω reklamn√Ω rozpoƒçet</h4><div class="budget-opts"><div class="budget-opt"><div class="amount">250‚Ç¨</div><div class="label">~700 kliknut√≠/mes</div></div><div class="budget-opt featured"><div class="amount">450‚Ç¨</div><div class="label">~1,300 kliknut√≠/mes</div></div><div class="budget-opt"><div class="amount">700‚Ç¨</div><div class="label">~2,100 kliknut√≠/mes</div></div></div></div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">6</div><h2>Predpokladan√° n√°vratnos≈•</h2></div><p style="color:#6b7280;margin-bottom:25px">Pri bal√≠ku Pro (249‚Ç¨) a rozpoƒçte 450‚Ç¨/mesiac:</p><div class="grid-4" style="margin-bottom:30px"><div class="roi-card"><div class="value">40,000+</div><div class="label">Zobrazen√≠</div></div><div class="roi-card"><div class="value">1,300</div><div class="label">Kliknut√≠</div></div><div class="roi-card"><div class="value">${roi.new_customers_min||40}-${roi.new_customers_max||70}</div><div class="label">Z√°kazn√≠kov</div></div><div class="roi-card"><div class="value">5-8x</div><div class="label">ROI</div></div></div><div class="calc-box"><h4 style="margin-bottom:20px">üìä Pr√≠klad v√Ωpoƒçtu:</h4><div class="calc-row"><span>Invest√≠cia:</span><span>249‚Ç¨ + 450‚Ç¨ = <strong>699‚Ç¨/mes</strong></span></div><div class="calc-row"><span>Nov√≠ z√°kazn√≠ci:</span><span>~${avgCust} mesaƒçne</span></div><div class="calc-row"><span>Priem. √∫trata:</span><span>${avgOrder}‚Ç¨</span></div><div class="calc-row"><span>Tr≈æba:</span><span><strong>${revenue.toLocaleString()}‚Ç¨</strong></span></div><div class="calc-row total"><span><strong>ƒåist√Ω zisk:</strong></span><span>+${profit.toLocaleString()}‚Ç¨</span></div></div></div></div>

<div class="slide"><div class="slide-content"><div class="slide-header"><div class="slide-num">7</div><h2>ƒåo v√°m spolupr√°ca prinesie</h2></div><div class="grid-2">${benefitsHTML}</div></div></div>

<div class="slide"><div class="slide-cta"><h2>Zaƒçnime spolupr√°cu</h2><p>Dohodnite si nez√°v√§zn√∫ konzult√°ciu a preberieme, ako v√°m vieme pom√¥c≈• z√≠ska≈• viac z√°kazn√≠kov.</p><div class="cta-btns"><a href="mailto:info@adlify.eu?subject=M√°m z√°ujem - ${encodeURIComponent(name)}" class="btn btn-white">‚úì M√°m z√°ujem</a><a href="mailto:info@adlify.eu?subject=Ot√°zka - ${encodeURIComponent(name)}" class="btn btn-outline">M√°m ot√°zky</a></div><div class="contact">üìß <a href="mailto:info@adlify.eu">info@adlify.eu</a> | üåê <a href="https://adlify.eu">adlify.eu</a></div></div></div>

</body></html>`;
    }
    </script>
</body>
</html>
