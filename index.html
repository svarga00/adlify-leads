<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adlify - Lead Generation App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'adlify-orange': '#FF6B35',
                        'adlify-pink': '#E91E63',
                        'adlify-purple': '#9C27B0',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #FF6B35 0%, #E91E63 50%, #9C27B0 100%); }
        .gradient-text {
            background: linear-gradient(135deg, #FF6B35 0%, #E91E63 50%, #9C27B0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        input:focus, textarea:focus { border-color: #FF6B35 !important; box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.15); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold tracking-tight">ADLIFY</span>
                </div>
                <div class="flex items-center gap-4">
                    <span id="dbStatus" class="text-sm bg-white/20 px-3 py-1 rounded-full">‚è≥ Prip√°jam...</span>
                    <button onclick="openSettings()" class="text-white/80 hover:text-white">‚öôÔ∏è Nastavenia</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-6 py-3">
            <div class="flex items-center gap-8 text-sm">
                <div><span class="text-gray-500">Celkom leadov:</span> <strong id="totalLeads">0</strong></div>
                <div><span class="text-gray-500">üÜï Nov√Ωch:</span> <strong id="newLeads">0</strong></div>
                <div><span class="text-gray-500">üìß Kontaktovan√Ωch:</span> <strong id="contactedLeads">0</strong></div>
                <div><span class="text-gray-500">‚úÖ Klientov:</span> <strong id="convertedLeads">0</strong></div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Tabs -->
        <div class="flex gap-2 mb-6">
            <button onclick="showTab('search')" id="tab-search" class="px-4 py-2 rounded-lg font-medium bg-adlify-orange text-white">üîç Vyhƒæad√°vanie</button>
            <button onclick="showTab('import')" id="tab-import" class="px-4 py-2 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">üì• Import dom√©n</button>
            <button onclick="showTab('enrich')" id="tab-enrich" class="px-4 py-2 rounded-lg font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">‚ú® Obohati≈• d√°ta</button>
        </div>

        <!-- Search Tab -->
        <div id="panel-search" class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <svg class="w-7 h-7 text-adlify-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                Vyhƒæada≈• nov√© firmy
            </h1>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Remeslo / Odvetvie</label>
                    <input type="text" id="trade" placeholder="napr. autoservis, kadern√≠ctvo..." 
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mesto</label>
                    <input type="text" id="city" placeholder="napr. Bratislava, Ko≈°ice..."
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition">
                </div>
                <div class="flex items-end">
                    <button id="searchBtn" onclick="handleSearch()" class="w-full gradient-bg text-white font-semibold py-3 px-6 rounded-xl hover:opacity-90 transition flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        Vyhƒæada≈• firmy
                    </button>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-xl text-sm text-blue-800">
                <strong>üí° Ako to funguje:</strong><br>
                1. Zadaj remeslo a mesto<br>
                2. Syst√©m vyhƒæad√° firmy cez Google<br>
                3. Marketing Miner obohat√≠ kontakty (email, FB, IG)<br>
                4. V√Ωsledky sa ulo≈æia do datab√°zy
            </div>
        </div>

        <!-- Import Tab -->
        <div id="panel-import" class="bg-white rounded-2xl shadow-lg p-8 mb-8 hidden">
            <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                üì• Import dom√©n
            </h1>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Zoznam dom√©n (jedna na riadok)</label>
                <textarea id="domainList" rows="10" placeholder="hadvoservis.sk
autodiskanec.sk
autoservisjurik.sk
..." class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition font-mono text-sm"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Zdroj (query)</label>
                    <input type="text" id="importQuery" placeholder="autoservis" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mesto</label>
                    <input type="text" id="importCity" placeholder="Bratislava" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition">
                </div>
            </div>
            
            <button onclick="handleImport()" id="importBtn" class="gradient-bg text-white font-semibold py-3 px-6 rounded-xl hover:opacity-90 transition flex items-center justify-center gap-2">
                üì• Importova≈• dom√©ny
            </button>
        </div>

        <!-- Enrich Tab -->
        <div id="panel-enrich" class="bg-white rounded-2xl shadow-lg p-8 mb-8 hidden">
            <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                ‚ú® Obohati≈• d√°ta (Marketing Miner)
            </h1>
            
            <div class="mb-6 p-4 bg-yellow-50 rounded-xl text-sm text-yellow-800">
                <strong>‚ö†Ô∏è Pozn√°mka:</strong> T√°to funkcia vy≈æaduje Marketing Miner API. 
                Aktu√°lne je potrebn√© exportova≈• dom√©ny, spusti≈• Contact Finder v MM a importova≈• v√Ωsledky sp√§≈•.
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <button onclick="exportDomainsForMM()" class="p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-adlify-orange hover:bg-orange-50 transition text-center">
                    <div class="text-2xl mb-2">üì§</div>
                    <div class="font-medium">Exportova≈• dom√©ny</div>
                    <div class="text-sm text-gray-500">Pre Marketing Miner Contact Finder</div>
                </button>
                <button onclick="document.getElementById('mmFileInput').click()" class="p-4 border-2 border-dashed border-gray-300 rounded-xl hover:border-adlify-orange hover:bg-orange-50 transition text-center">
                    <div class="text-2xl mb-2">üì•</div>
                    <div class="font-medium">Importova≈• z MM</div>
                    <div class="text-sm text-gray-500">Excel s√∫bor z Contact Finder</div>
                </button>
                <input type="file" id="mmFileInput" accept=".xlsx,.xls,.csv" onchange="handleMMImport(event)" class="hidden">
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <h2 class="text-lg font-semibold text-gray-800">
                        Leady: <span class="gradient-text" id="resultsCount">0</span>
                    </h2>
                </div>
                <div class="flex items-center gap-3">
                    <select id="statusFilter" onchange="loadLeads()" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                        <option value="">V≈°etky stavy</option>
                        <option value="new">üÜï Nov√©</option>
                        <option value="ready">‚ú® Pripraven√©</option>
                        <option value="contacted">üìß Kontaktovan√©</option>
                        <option value="converted">‚úÖ Klienti</option>
                        <option value="rejected">‚ùå Nez√°ujem</option>
                    </select>
                    <button onclick="loadLeads()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition">
                        üîÑ Obnovi≈•
                    </button>
                </div>
            </div>
            <div id="leadsList" class="divide-y divide-gray-100"></div>
            <div id="emptyList" class="p-12 text-center text-gray-500">
                ≈Ωiadne leady. Spustite vyhƒæad√°vanie alebo importujte dom√©ny.
            </div>
        </div>
    </main>

    <!-- Status Change Modal -->
    <div id="statusModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4">Zmeni≈• stav</h3>
            <input type="hidden" id="modalLeadId">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="setStatus('new')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">üÜï Nov√Ω</button>
                <button onclick="setStatus('ready')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">‚ú® Pripraven√Ω</button>
                <button onclick="setStatus('contacted')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">üìß Kontaktovan√Ω</button>
                <button onclick="setStatus('responded')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">üí¨ Odpovedal</button>
                <button onclick="setStatus('converted')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">‚úÖ Klient</button>
                <button onclick="setStatus('rejected')" class="p-3 border rounded-xl hover:bg-gray-50 text-left">‚ùå Nez√°ujem</button>
            </div>
            <button onclick="closeModal()" class="mt-4 w-full py-2 bg-gray-100 rounded-xl text-gray-700 hover:bg-gray-200">Zru≈°i≈•</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-full max-w-lg mx-4">
            <h3 class="text-lg font-semibold mb-4">‚öôÔ∏è Nastavenia</h3>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Claude API Key</label>
                <input type="password" id="settingsApiKey" placeholder="sk-ant-api03-..." 
                       class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none transition font-mono text-sm">
                <p class="text-xs text-gray-500 mt-1">Z√≠skaj na <a href="https://console.anthropic.com" target="_blank" class="text-adlify-orange">console.anthropic.com</a></p>
            </div>
            <div class="flex gap-3">
                <button onclick="saveSettings()" class="flex-1 gradient-bg text-white font-semibold py-2 px-4 rounded-xl hover:opacity-90 transition">Ulo≈æi≈•</button>
                <button onclick="closeSettings()" class="px-4 py-2 bg-gray-100 rounded-xl text-gray-700 hover:bg-gray-200">Zru≈°i≈•</button>
            </div>
        </div>
    </div>

    <!-- Include SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <script>
        // Claude API key - will be entered by user in settings
        let CLAUDE_API_KEY = localStorage.getItem('claude_api_key') || '';
        
        // Supabase setup
        const SUPABASE_URL = 'https://eidkljfaeqvvegiponwl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpZGtsamZhZXF2dmVnaXBvbndsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4NTgzNjgsImV4cCI6MjA4MjQzNDM2OH0.jFJe_IddYNiO-TOAdxhPSYtSQJlx4i6CFflB0CN4AIQ';
        
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Tab switching
        function showTab(tab) {
            ['search', 'import', 'enrich'].forEach(t => {
                document.getElementById(`panel-${t}`).classList.toggle('hidden', t !== tab);
                document.getElementById(`tab-${t}`).classList.toggle('bg-adlify-orange', t === tab);
                document.getElementById(`tab-${t}`).classList.toggle('text-white', t === tab);
                document.getElementById(`tab-${t}`).classList.toggle('bg-gray-100', t !== tab);
                document.getElementById(`tab-${t}`).classList.toggle('text-gray-700', t !== tab);
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', async () => {
            await checkConnection();
            await loadLeads();
            await loadStats();
        });

        async function checkConnection() {
            try {
                const { count, error } = await supabaseClient.from('leads').select('*', { count: 'exact', head: true });
                if (error) throw error;
                document.getElementById('dbStatus').innerHTML = '‚úÖ Pripojen√©';
                document.getElementById('dbStatus').className = 'text-sm bg-green-500/30 px-3 py-1 rounded-full';
            } catch (e) {
                document.getElementById('dbStatus').innerHTML = '‚ùå Chyba DB';
                document.getElementById('dbStatus').className = 'text-sm bg-red-500/30 px-3 py-1 rounded-full';
                console.error('DB Error:', e);
            }
        }

        async function loadStats() {
            const { data: leads } = await supabaseClient.from('leads').select('status');
            if (!leads) return;
            
            document.getElementById('totalLeads').textContent = leads.length;
            document.getElementById('newLeads').textContent = leads.filter(l => l.status === 'new' || l.status === 'ready').length;
            document.getElementById('contactedLeads').textContent = leads.filter(l => l.status === 'contacted').length;
            document.getElementById('convertedLeads').textContent = leads.filter(l => l.status === 'converted').length;
        }

        async function loadLeads() {
            const statusFilter = document.getElementById('statusFilter').value;
            
            let query = supabaseClient.from('leads').select('*').order('score', { ascending: false });
            if (statusFilter) {
                query = query.eq('status', statusFilter);
            }
            
            const { data: leads, error } = await query;
            
            if (error) {
                console.error('Load error:', error);
                return;
            }
            
            renderLeads(leads || []);
        }

        // Search - for now shows instructions since we need backend
        async function handleSearch() {
            const trade = document.getElementById('trade').value.trim();
            const city = document.getElementById('city').value.trim();
            
            if (!trade || !city) {
                alert('Pros√≠m vypl≈àte obe polia');
                return;
            }

            const btn = document.getElementById('searchBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Vyhƒæad√°vam...';

            // For now, show instructions
            alert(`Pre vyhƒæadanie "${trade} ${city}":\n\n1. Choƒè na Google a hƒæadaj "${trade} ${city}"\n2. Skop√≠ruj dom√©ny firiem\n3. Vlo≈æ ich do z√°lo≈æky "Import dom√©n"\n\nAlebo pou≈æi Marketing Miner Report s Contact Finder.`);

            btn.disabled = false;
            btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg> Vyhƒæada≈• firmy';
        }

        // Import domains manually
        async function handleImport() {
            const domainList = document.getElementById('domainList').value.trim();
            const query = document.getElementById('importQuery').value.trim();
            const city = document.getElementById('importCity').value.trim();
            
            if (!domainList) {
                alert('Zadajte zoznam dom√©n');
                return;
            }

            const btn = document.getElementById('importBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Importujem...';

            const domains = domainList.split('\n').map(d => d.trim()).filter(d => d && d.includes('.'));
            let addedCount = 0;

            for (const domain of domains) {
                const cleanDomain = domain.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];
                
                const { data: existing } = await supabaseClient.from('leads').select('id').eq('domain', cleanDomain).single();
                
                if (!existing) {
                    const { error } = await supabaseClient.from('leads').insert({
                        domain: cleanDomain,
                        company_name: cleanDomain.split('.')[0],
                        source_query: query || null,
                        source_city: city || null,
                        status: 'new',
                        score: 50
                    });
                    if (!error) addedCount++;
                }
            }

            btn.disabled = false;
            btn.innerHTML = 'üì• Importova≈• dom√©ny';
            
            alert(`Importovan√Ωch ${addedCount} nov√Ωch dom√©n z ${domains.length}`);
            document.getElementById('domainList').value = '';
            
            await loadLeads();
            await loadStats();
        }

        // Export domains for Marketing Miner
        async function exportDomainsForMM() {
            const { data: leads } = await supabaseClient.from('leads').select('domain').is('email', null);
            
            if (!leads || leads.length === 0) {
                alert('≈Ωiadne dom√©ny na export (v≈°etky u≈æ maj√∫ kontakty)');
                return;
            }

            const domains = leads.map(l => l.domain).join('\n');
            
            // Download as text file
            const blob = new Blob([domains], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'domains-for-marketing-miner.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            alert(`Exportovan√Ωch ${leads.length} dom√©n.\n\n1. Nahraj s√∫bor do Marketing Miner\n2. Spusti Contact Finder miner\n3. Exportuj v√Ωsledky ako Excel\n4. Importuj sp√§≈• cez "Importova≈• z MM"`);
        }

        // Import from Marketing Miner Excel
        async function handleMMImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const json = XLSX.utils.sheet_to_json(sheet);

                    let updatedCount = 0;

                    for (const row of json) {
                        // Marketing Miner columns: Input, Contact Page, Contact Emails, Facebook, Instagram, etc.
                        const domain = (row['Input'] || row['Domain'] || '').toString().trim();
                        if (!domain) continue;

                        const cleanDomain = domain.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];

                        // Parse email (remove confidence percentage)
                        let email = row['Contact Emails'] || row['Email'] || '';
                        if (email) {
                            email = email.split(';')[0].split('(')[0].trim();
                            if (!email.includes('@')) email = null;
                        }

                        const updateData = {};
                        if (email) updateData.email = email;
                        if (row['Contact Page']) updateData.contact_page = row['Contact Page'];
                        if (row['Facebook']) updateData.facebook = row['Facebook'].split(';')[0].trim();
                        if (row['Instagram']) updateData.instagram = row['Instagram'].split(';')[0].trim();
                        if (row['YouTube']) updateData.youtube = row['YouTube'];
                        if (row['LinkedIn']) updateData.linkedin = row['LinkedIn'];
                        if (row['TikTok']) updateData.tiktok = row['TikTok'];

                        // Calculate score
                        let score = 50;
                        if (updateData.email) score += 20;
                        if (updateData.facebook) score += 10;
                        if (updateData.instagram) score += 10;
                        if (updateData.contact_page) score += 5;
                        if (updateData.youtube) score += 3;
                        if (updateData.linkedin) score += 2;
                        updateData.score = Math.min(score, 100);

                        if (Object.keys(updateData).length > 1) {
                            const { error } = await supabase
                                .from('leads')
                                .update(updateData)
                                .eq('domain', cleanDomain);
                            
                            if (!error) updatedCount++;
                        }
                    }

                    alert(`Aktualizovan√Ωch ${updatedCount} leadov z ${json.length} riadkov`);
                    await loadLeads();
                    await loadStats();
                } catch (err) {
                    console.error('Import error:', err);
                    alert('Chyba pri importe: ' + err.message);
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function renderLeads(leads) {
            const list = document.getElementById('leadsList');
            const empty = document.getElementById('emptyList');
            const count = document.getElementById('resultsCount');
            
            count.textContent = leads.length;
            
            if (leads.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            
            list.innerHTML = leads.map((lead, index) => `
                <div class="px-6 py-4 hover:bg-gray-50 transition animate-fade-in" style="animation-delay: ${index * 30}ms">
                    <div class="flex items-center gap-4">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-3 mb-1 flex-wrap">
                                <h3 class="font-semibold text-gray-800">${lead.company_name || lead.domain}</h3>
                                <a href="https://${lead.domain}" target="_blank" class="text-sm text-adlify-orange hover:underline flex items-center gap-1">
                                    ${lead.domain}
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
                                </a>
                                ${getStatusBadge(lead.status)}
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-500 flex-wrap">
                                ${lead.email ? `<span class="flex items-center gap-1 text-green-600">üìß ${lead.email}</span>` : '<span class="text-gray-300">üìß Bez emailu</span>'}
                                ${lead.facebook ? `<a href="${lead.facebook}" target="_blank" class="text-blue-600 hover:text-blue-700">FB ‚úì</a>` : ''}
                                ${lead.instagram ? `<a href="${lead.instagram}" target="_blank" class="text-pink-600 hover:text-pink-700">IG ‚úì</a>` : ''}
                                ${lead.contacted_at ? `<span class="text-gray-400">üìÖ ${new Date(lead.contacted_at).toLocaleDateString('sk')}</span>` : ''}
                            </div>
                        </div>
                        <div class="px-3 py-1 rounded-full text-sm font-semibold ${getScoreClass(lead.score)}">‚≠ê ${lead.score}</div>
                        <div class="flex items-center gap-2">
                            ${getActionButtons(lead)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusBadge(status) {
            const badges = {
                'new': '<span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium">üÜï Nov√Ω</span>',
                'analyzing': '<span class="px-2 py-0.5 bg-yellow-100 text-yellow-700 rounded text-xs font-medium">‚è≥ Analyzuje sa</span>',
                'ready': '<span class="px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs font-medium">‚ú® Pripraven√Ω</span>',
                'contacted': '<span class="px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-medium">üìß Kontaktovan√Ω</span>',
                'responded': '<span class="px-2 py-0.5 bg-teal-100 text-teal-700 rounded text-xs font-medium">üí¨ Odpovedal</span>',
                'converted': '<span class="px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium">‚úÖ Klient</span>',
                'rejected': '<span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium">‚ùå Nez√°ujem</span>',
            };
            return badges[status] || '';
        }

        function getScoreClass(score) {
            if (score >= 80) return 'text-green-600 bg-green-100';
            if (score >= 60) return 'text-yellow-600 bg-yellow-100';
            return 'text-red-600 bg-red-100';
        }

        function getActionButtons(lead) {
            let buttons = '';
            
            // Analyze button for new leads without analysis
            if ((lead.status === 'new' || !lead.analysis) && lead.status !== 'analyzing') {
                buttons += `<button onclick="analyzeLead('${lead.id}', '${lead.domain}')" id="btn-analyze-${lead.id}" class="px-3 py-2 bg-adlify-orange/10 text-adlify-orange rounded-lg text-sm font-medium hover:bg-adlify-orange/20 transition">ü§ñ Analyzova≈•</button>`;
            }
            
            // Analyzing status
            if (lead.status === 'analyzing') {
                buttons += `<span class="px-3 py-2 bg-yellow-100 text-yellow-700 rounded-lg text-sm">‚è≥ Analyzujem...</span>`;
            }
            
            // Presentation button for leads with analysis
            if (lead.analysis) {
                buttons += `<button onclick="generatePresentation('${lead.id}')" class="px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition">üìÑ Prezent√°cia</button>`;
            }
            
            // Send button for ready leads with email
            if (lead.status === 'ready' && lead.email) {
                buttons += `<button onclick="markAsContacted('${lead.id}')" class="px-3 py-2 gradient-bg text-white rounded-lg text-sm font-medium hover:opacity-90 transition">üìß Odoslan√©</button>`;
            }
            
            // Settings button
            buttons += `<button onclick="openModal('${lead.id}')" class="px-3 py-2 bg-gray-100 text-gray-600 rounded-lg text-sm hover:bg-gray-200 transition">‚öôÔ∏è</button>`;
            
            return buttons;
        }

        async function setStatusDirect(id, status) {
            await supabaseClient.from('leads').update({ status }).eq('id', id);
            await loadLeads();
            await loadStats();
        }

        async function markAsContacted(id) {
            await supabaseClient.from('leads').update({ 
                status: 'contacted',
                contacted_at: new Date().toISOString()
            }).eq('id', id);
            await loadLeads();
            await loadStats();
        }

        function openModal(id) {
            document.getElementById('modalLeadId').value = id;
            document.getElementById('statusModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('statusModal').classList.add('hidden');
        }

        async function setStatus(status) {
            const id = document.getElementById('modalLeadId').value;
            const updateData = { status };
            if (status === 'contacted') updateData.contacted_at = new Date().toISOString();
            await supabaseClient.from('leads').update(updateData).eq('id', id);
            closeModal();
            await loadLeads();
            await loadStats();
        }

        document.getElementById('statusModal').addEventListener('click', (e) => {
            if (e.target.id === 'statusModal') closeModal();
        });

        document.getElementById('trade').addEventListener('keypress', e => { if (e.key === 'Enter') handleSearch(); });
        document.getElementById('city').addEventListener('keypress', e => { if (e.key === 'Enter') handleSearch(); });

        // Settings functions
        function openSettings() {
            document.getElementById('settingsApiKey').value = CLAUDE_API_KEY;
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function saveSettings() {
            const apiKey = document.getElementById('settingsApiKey').value.trim();
            if (apiKey) {
                CLAUDE_API_KEY = apiKey;
                localStorage.setItem('claude_api_key', apiKey);
                alert('‚úÖ API kƒæ√∫ƒç ulo≈æen√Ω!');
            }
            closeSettings();
        }

        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target.id === 'settingsModal') closeSettings();
        });

        // AI Analysis function
        async function analyzeLead(id, domain) {
            // Check for API key
            if (!CLAUDE_API_KEY) {
                alert('‚ö†Ô∏è Najprv nastav Claude API kƒæ√∫ƒç v Nastaveniach (‚öôÔ∏è vpravo hore)');
                openSettings();
                return;
            }

            const btn = document.getElementById(`btn-analyze-${id}`);
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '‚è≥ Analyzujem...';
            }

            // Update status to analyzing
            await supabaseClient.from('leads').update({ status: 'analyzing' }).eq('id', id);
            await loadLeads();

            try {
                console.log('Starting analysis for:', domain);
                
                // Fetch website content (using a CORS proxy for demo)
                let websiteContent = '';
                try {
                    console.log('Fetching website...');
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent('https://' + domain)}`;
                    const response = await fetch(proxyUrl, { timeout: 10000 });
                    if (response.ok) {
                        const html = await response.text();
                        // Extract text content from HTML
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        // Remove scripts and styles
                        doc.querySelectorAll('script, style, nav, footer, header').forEach(el => el.remove());
                        websiteContent = doc.body?.innerText?.substring(0, 5000) || '';
                        console.log('Website content loaded:', websiteContent.substring(0, 200) + '...');
                    }
                } catch (e) {
                    console.log('Could not fetch website:', e.message);
                }

                console.log('Calling Claude API...');
                
                // Call Claude API for analysis
                const analysisResponse = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': CLAUDE_API_KEY,
                        'anthropic-version': '2023-06-01',
                        'anthropic-dangerous-direct-browser-access': 'true'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: `Analyzuj t√∫to slovensk√∫ firmu a vytvor JSON anal√Ωzu pre marketingov√∫ prezent√°ciu.

Dom√©na: ${domain}
${websiteContent ? `Obsah webu:\n${websiteContent}` : 'Obsah webu sa nepodarilo naƒç√≠ta≈•, analyzuj na z√°klade dom√©ny.'}

Vytvor JSON v tomto form√°te (bez markdown, len ƒçist√Ω JSON):
{
    "company_name": "N√°zov firmy",
    "description": "Struƒçn√Ω popis firmy (2-3 vety)",
    "services": ["slu≈æba1", "slu≈æba2", "slu≈æba3"],
    "strengths": ["siln√° str√°nka 1", "siln√° str√°nka 2"],
    "weaknesses": ["slab√° str√°nka / pr√≠le≈æitos≈• 1"],
    "potential": "Kde vid√≠me marketingov√Ω potenci√°l (2-3 vety)",
    "keywords": [
        {"keyword": "kl√∫ƒçov√© slovo 1", "volume": 500, "difficulty": "easy"},
        {"keyword": "kl√∫ƒçov√© slovo 2", "volume": 300, "difficulty": "medium"}
    ],
    "recommended_package": "pro",
    "roi_estimate": {
        "new_customers": "30-50",
        "avg_order": "80‚Ç¨",
        "monthly_revenue": "3000‚Ç¨"
    }
}

Odpovedz LEN s JSON, ≈æiadny in√Ω text.`
                        }]
                    })
                });

                console.log('Claude API response status:', analysisResponse.status);

                if (!analysisResponse.ok) {
                    const errorText = await analysisResponse.text();
                    console.error('Claude API error:', errorText);
                    throw new Error('Claude API error: ' + analysisResponse.status + ' - ' + errorText);
                }

                const analysisData = await analysisResponse.json();
                console.log('Claude response:', analysisData);
                
                const analysisText = analysisData.content[0].text;
                console.log('Analysis text:', analysisText);
                
                // Parse JSON from response
                let analysis;
                try {
                    analysis = JSON.parse(analysisText);
                } catch (e) {
                    // Try to extract JSON from response
                    const jsonMatch = analysisText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        analysis = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error('Could not parse analysis JSON');
                    }
                }

                console.log('Parsed analysis:', analysis);

                // Update lead with analysis
                await supabaseClient.from('leads').update({
                    status: 'ready',
                    analysis: analysis,
                    company_name: analysis.company_name || domain.split('.')[0],
                    score: calculateScore(analysis)
                }).eq('id', id);

                alert(`‚úÖ Anal√Ωza dokonƒçen√° pre ${domain}!`);

            } catch (error) {
                console.error('Analysis error:', error);
                alert('‚ùå Chyba pri anal√Ωze: ' + error.message + '\n\nPozri Console (F12) pre detaily.');
                await supabaseClient.from('leads').update({ status: 'new' }).eq('id', id);
            }

            await loadLeads();
            await loadStats();
        }

        function calculateScore(analysis) {
            let score = 60; // base score
            if (analysis.services?.length > 3) score += 10;
            if (analysis.strengths?.length > 1) score += 10;
            if (analysis.keywords?.length > 3) score += 10;
            if (analysis.roi_estimate) score += 10;
            return Math.min(score, 100);
        }

        // Generate presentation
        async function generatePresentation(id) {
            const { data: lead } = await supabaseClient.from('leads').select('*').eq('id', id).single();
            
            if (!lead) {
                alert('Lead nen√°jden√Ω');
                return;
            }

            if (!lead.analysis) {
                alert('Najprv spusti anal√Ωzu firmy');
                return;
            }

            const analysis = lead.analysis;
            
            // Generate HTML presentation
            const html = generatePresentationHTML(lead, analysis);
            
            // Save to lead
            await supabaseClient.from('leads').update({ presentation_html: html }).eq('id', id);
            
            // Open in new window
            const win = window.open('', '_blank');
            win.document.write(html);
            win.document.close();
        }

        function generatePresentationHTML(lead, analysis) {
            const keywords = analysis.keywords || [];
            const services = analysis.services || [];
            const strengths = analysis.strengths || [];
            const weaknesses = analysis.weaknesses || [];
            const companyName = analysis.company_name || lead.domain.split('.')[0];
            
            return `<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketingov√Ω n√°vrh - ${companyName}</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #fff; }
        
        .slide {
            min-height: 100vh;
            padding: 60px 80px;
            position: relative;
            overflow: hidden;
        }
        
        /* Slide 1 - Title */
        .slide-title {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .slide-title::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="%23D4AF37" stroke-width="0.5" opacity="0.1"/></svg>') center/cover;
            opacity: 0.3;
        }
        .logo-badge {
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            color: #1a1a2e;
            padding: 8px 24px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 2px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        .company-name {
            font-family: 'Playfair Display', serif;
            font-size: 72px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        .tagline {
            font-size: 24px;
            color: #888;
            font-weight: 300;
            margin-bottom: 60px;
            position: relative;
            z-index: 1;
        }
        .domain-badge {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid #D4AF37;
            padding: 12px 30px;
            border-radius: 50px;
            color: #D4AF37;
            font-size: 16px;
            position: relative;
            z-index: 1;
        }
        
        /* Slide header */
        .slide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }
        .slide-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: #1a1a2e;
        }
        .slide-title-text {
            font-family: 'Playfair Display', serif;
            font-size: 42px;
            font-weight: 600;
        }
        .adlify-logo {
            color: #D4AF37;
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 2px;
        }
        
        /* Cards */
        .card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .card-gold {
            border-color: rgba(212, 175, 55, 0.3);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.02) 100%);
        }
        .card h3 {
            color: #D4AF37;
            font-size: 14px;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 15px;
        }
        .card p {
            color: #ccc;
            line-height: 1.7;
        }
        
        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        
        /* Stats */
        .stat-box {
            text-align: center;
            padding: 30px;
        }
        .stat-value {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label {
            color: #888;
            font-size: 14px;
            margin-top: 10px;
        }
        
        /* Keyword table */
        .keyword-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        .keyword-table th {
            text-align: left;
            color: #D4AF37;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 15px 20px;
        }
        .keyword-table td {
            background: rgba(255,255,255,0.03);
            padding: 18px 20px;
            color: #fff;
        }
        .keyword-table tr td:first-child { border-radius: 10px 0 0 10px; }
        .keyword-table tr td:last-child { border-radius: 0 10px 10px 0; }
        .difficulty-easy { color: #4CAF50; }
        .difficulty-medium { color: #FF9800; }
        .difficulty-hard { color: #f44336; }
        
        /* Pricing cards */
        .pricing-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            transition: transform 0.3s, border-color 0.3s;
        }
        .pricing-card.featured {
            border-color: #D4AF37;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0.05) 100%);
            transform: scale(1.05);
        }
        .pricing-card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .pricing-card .price {
            font-size: 56px;
            font-weight: 700;
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .pricing-card .period {
            color: #666;
            margin-bottom: 30px;
        }
        .pricing-card ul {
            list-style: none;
            text-align: left;
            margin-top: 20px;
        }
        .pricing-card ul li {
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #aaa;
        }
        .pricing-card ul li::before {
            content: '‚úì';
            color: #D4AF37;
            margin-right: 10px;
        }
        
        /* ROI Section */
        .roi-highlight {
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            color: #1a1a2e;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
        }
        .roi-highlight h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .roi-item .value {
            font-size: 32px;
            font-weight: 700;
        }
        .roi-item .label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* CTA Slide */
        .slide-cta {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .cta-title {
            font-family: 'Playfair Display', serif;
            font-size: 56px;
            margin-bottom: 20px;
        }
        .cta-subtitle {
            color: #888;
            font-size: 20px;
            margin-bottom: 50px;
        }
        .cta-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 60px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #D4AF37, #F4D03F);
            color: #1a1a2e;
            padding: 18px 40px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
        }
        .btn-secondary {
            border: 2px solid #D4AF37;
            color: #D4AF37;
            padding: 16px 40px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            text-decoration: none;
        }
        .contact-info {
            color: #D4AF37;
            font-size: 18px;
        }
        
        /* Chart container */
        .chart-container {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 30px;
            height: 300px;
        }
        
        /* Page break for print */
        @media print {
            .slide { page-break-after: always; }
        }
    </style>
</head>
<body>

    <!-- SLIDE 1: Title -->
    <div class="slide slide-title">
        <div class="logo-badge">ADLIFY</div>
        <h1 class="company-name">${companyName}</h1>
        <p class="tagline">N√°vrh online marketingovej strat√©gie</p>
        <div class="domain-badge">üåê ${lead.domain}</div>
    </div>

    <!-- SLIDE 2: O firme -->
    <div class="slide" style="background: #0f0f0f;">
        <div class="slide-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="slide-number">01</div>
                <h2 class="slide-title-text">O va≈°om biznise</h2>
            </div>
            <div class="adlify-logo">ADLIFY</div>
        </div>
        
        <div class="grid-2">
            <div>
                <div class="card" style="margin-bottom: 25px;">
                    <h3>üìã Popis firmy</h3>
                    <p>${analysis.description || 'Profesion√°lna firma poskytuj√∫ca kvalitn√© slu≈æby svojim z√°kazn√≠kom.'}</p>
                </div>
                <div class="card card-gold">
                    <h3>üõ†Ô∏è Slu≈æby</h3>
                    <p>${services.join(' ‚Ä¢ ') || 'R√¥zne profesion√°lne slu≈æby'}</p>
                </div>
            </div>
            <div>
                <div class="card" style="margin-bottom: 25px;">
                    <h3>‚úÖ Siln√© str√°nky</h3>
                    <ul style="list-style: none; color: #ccc;">
                        ${strengths.map(s => `<li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">‚úì ${s}</li>`).join('')}
                    </ul>
                </div>
                <div class="card">
                    <h3>üí° Pr√≠le≈æitosti</h3>
                    <p>${analysis.potential || 'S cielenou online reklamou viete oslovi≈• z√°kazn√≠kov, ktor√≠ pr√°ve teraz hƒæadaj√∫ va≈°e slu≈æby.'}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- SLIDE 3: Anal√Ωza trhu -->
    <div class="slide" style="background: #0f0f0f;">
        <div class="slide-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="slide-number">02</div>
                <h2 class="slide-title-text">Anal√Ωza trhu</h2>
            </div>
            <div class="adlify-logo">ADLIFY</div>
        </div>
        
        <div class="grid-3" style="margin-bottom: 40px;">
            <div class="card stat-box">
                <div class="stat-value">${keywords.reduce((sum, k) => sum + (k.volume || 0), 0).toLocaleString()}</div>
                <div class="stat-label">Mesaƒçn√Ωch vyhƒæad√°van√≠</div>
            </div>
            <div class="card stat-box">
                <div class="stat-value">${keywords.length}+</div>
                <div class="stat-label">Relevantn√Ωch kƒæ√∫ƒçov√Ωch slov</div>
            </div>
            <div class="card stat-box">
                <div class="stat-value">${analysis.roi_estimate?.new_customers || '30-50'}</div>
                <div class="stat-label">Potenci√°lnych z√°kazn√≠kov/mes</div>
            </div>
        </div>
        
        <div class="card">
            <h3>üîç Top kƒæ√∫ƒçov√© slov√°</h3>
            <table class="keyword-table">
                <thead>
                    <tr>
                        <th>Kƒæ√∫ƒçov√© slovo</th>
                        <th>Mesaƒçn√© vyhƒæad√°vania</th>
                        <th>Konkurencia</th>
                        <th>Potenci√°l</th>
                    </tr>
                </thead>
                <tbody>
                    ${keywords.slice(0, 5).map(k => `
                        <tr>
                            <td><strong>${k.keyword}</strong></td>
                            <td>${k.volume?.toLocaleString() || '100'}/mes</td>
                            <td class="difficulty-${k.difficulty || 'medium'}">${k.difficulty === 'easy' ? 'üü¢ N√≠zka' : k.difficulty === 'hard' ? 'üî¥ Vysok√°' : 'üü° Stredn√°'}</td>
                            <td>‚≠ê‚≠ê‚≠ê${k.difficulty === 'easy' ? '‚≠ê‚≠ê' : k.difficulty === 'medium' ? '‚≠ê' : ''}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    </div>

    <!-- SLIDE 4: Navrhovan√© rie≈°enie -->
    <div class="slide" style="background: #0f0f0f;">
        <div class="slide-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="slide-number">03</div>
                <h2 class="slide-title-text">Navrhovan√© rie≈°enie</h2>
            </div>
            <div class="adlify-logo">ADLIFY</div>
        </div>
        
        <div class="grid-3">
            <div class="pricing-card">
                <h3>üöÄ Starter</h3>
                <div class="price">149‚Ç¨</div>
                <div class="period">/mesiac</div>
                <ul>
                    <li>1 reklamn√° platforma</li>
                    <li>1 akt√≠vna kampa≈à</li>
                    <li>2 reklamn√© vizu√°ly</li>
                    <li>Mesaƒçn√Ω report</li>
                    <li>Email podpora</li>
                </ul>
            </div>
            <div class="pricing-card featured">
                <div style="background: #D4AF37; color: #1a1a2e; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-block; margin-bottom: 15px;">ODPOR√öƒåAN√â</div>
                <h3>‚≠ê Professional</h3>
                <div class="price">249‚Ç¨</div>
                <div class="period">/mesiac</div>
                <ul>
                    <li>2 reklamn√© platformy</li>
                    <li>3 akt√≠vne kampane</li>
                    <li>4 reklamn√© vizu√°ly</li>
                    <li>A/B testovanie</li>
                    <li>T√Ω≈ædenn√© reporty</li>
                    <li>Prioritn√° podpora</li>
                </ul>
            </div>
            <div class="pricing-card">
                <h3>üíé Enterprise</h3>
                <div class="price">399‚Ç¨</div>
                <div class="period">/mesiac</div>
                <ul>
                    <li>V≈°etky platformy</li>
                    <li>5 akt√≠vnych kampan√≠</li>
                    <li>8 reklamn√Ωch vizu√°lov</li>
                    <li>Remarketing</li>
                    <li>Video reklamy</li>
                    <li>Dedikovan√Ω mana≈æ√©r</li>
                </ul>
            </div>
        </div>
        
        <div style="margin-top: 40px; text-align: center;">
            <div class="card card-gold" style="display: inline-block; padding: 20px 40px;">
                <p style="margin: 0; color: #D4AF37;">üí∞ <strong>Odpor√∫ƒçan√Ω reklamn√Ω rozpoƒçet:</strong> 300 - 500 ‚Ç¨ / mesiac</p>
                <p style="margin: 10px 0 0 0; font-size: 14px; color: #888;">Plat√≠te priamo Google/Meta. M√°te pln√∫ kontrolu nad v√Ωdavkami.</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 5: ROI -->
    <div class="slide" style="background: #0f0f0f;">
        <div class="slide-header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="slide-number">04</div>
                <h2 class="slide-title-text">Oƒçak√°van√° n√°vratnos≈•</h2>
            </div>
            <div class="adlify-logo">ADLIFY</div>
        </div>
        
        <div class="roi-highlight">
            <h3>üí∞ PROJEKCIA ROI - PROFESSIONAL BAL√çK</h3>
            <div class="roi-grid">
                <div class="roi-item">
                    <div class="value">${analysis.roi_estimate?.new_customers || '30-50'}</div>
                    <div class="label">Nov√Ωch z√°kazn√≠kov/mes</div>
                </div>
                <div class="roi-item">
                    <div class="value">${analysis.roi_estimate?.avg_order || '80‚Ç¨'}</div>
                    <div class="label">Priemern√° objedn√°vka</div>
                </div>
                <div class="roi-item">
                    <div class="value">${analysis.roi_estimate?.monthly_revenue || '3 000‚Ç¨'}</div>
                    <div class="label">Potenci√°lna tr≈æba/mes</div>
                </div>
                <div class="roi-item">
                    <div class="value">4-5x</div>
                    <div class="label">N√°vratnos≈• invest√≠cie</div>
                </div>
            </div>
        </div>
        
        <div class="grid-2" style="margin-top: 40px;">
            <div class="card">
                <h3>üìä Va≈°a invest√≠cia</h3>
                <table style="width: 100%; color: #ccc;">
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 15px 0;">Spr√°va kampan√≠ (Pro)</td>
                        <td style="padding: 15px 0; text-align: right; color: #D4AF37;">249 ‚Ç¨</td>
                    </tr>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 15px 0;">Reklamn√Ω rozpoƒçet</td>
                        <td style="padding: 15px 0; text-align: right; color: #D4AF37;">400 ‚Ç¨</td>
                    </tr>
                    <tr>
                        <td style="padding: 15px 0; font-weight: 600; color: #fff;">CELKOM</td>
                        <td style="padding: 15px 0; text-align: right; font-weight: 700; font-size: 24px; color: #D4AF37;">649 ‚Ç¨/mes</td>
                    </tr>
                </table>
            </div>
            <div class="card card-gold">
                <h3>üéØ V√°≈° zisk</h3>
                <p style="font-size: 18px; margin-bottom: 20px;">Pri konverzii <strong>30 z√°kazn√≠kov</strong> s priemernou objedn√°vkou <strong>${analysis.roi_estimate?.avg_order || '80‚Ç¨'}</strong>:</p>
                <div style="font-size: 48px; font-weight: 700; color: #D4AF37; margin-bottom: 10px;">${analysis.roi_estimate?.monthly_revenue || '3 000‚Ç¨'}</div>
                <p style="color: #4CAF50; font-weight: 600;">‚úì ƒåist√Ω zisk: ~${parseInt((analysis.roi_estimate?.monthly_revenue || '3000').replace(/[^0-9]/g, '')) - 649}‚Ç¨ / mesiac</p>
            </div>
        </div>
    </div>

    <!-- SLIDE 6: CTA -->
    <div class="slide slide-cta">
        <h2 class="cta-title">Zaƒçnime spolupr√°cu</h2>
        <p class="cta-subtitle">Dohodnite si nez√°v√§zn√∫ konzult√°ciu a preberieme detaily va≈°ej kampane.</p>
        
        <div class="cta-buttons">
            <a href="mailto:info@adlify.eu?subject=M√°m z√°ujem o spolupr√°cu - ${companyName}" class="btn-primary">‚úì M√°m z√°ujem</a>
            <a href="mailto:info@adlify.eu?subject=Ot√°zka - ${companyName}" class="btn-secondary">M√°m ot√°zky</a>
        </div>
        
        <div class="contact-info">
            üìß info@adlify.eu &nbsp;&nbsp;|&nbsp;&nbsp; üåê adlify.eu
        </div>
        
        <div style="position: absolute; bottom: 40px; color: #666; font-size: 14px;">
            <span style="color: #D4AF37; font-weight: 700;">ADLIFY</span> &nbsp;|&nbsp; Online marketing pre mal√© firmy
        </div>
    </div>

</body>
</html>`;
        }
    </script>
</body>
</html>
